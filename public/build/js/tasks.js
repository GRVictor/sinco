!function(){!async function(){try{const e=`/api/tasks?url=${d()}`,n=await fetch(e),s=await n.json();t=s.tasks,a()}catch(t){console.log(t)}}();let t=[],e=[];document.querySelector("#add-task").addEventListener("click",(function(){s()}));function n(n){const s=n.target.value;e=""!==s?t.filter((t=>t.status===s)):[],a()}function a(){!function(){const t=document.querySelector("#task-list");for(;t.firstChild;)t.removeChild(t.firstChild)}(),function(){const e=t.filter((t=>"0"===t.status)).length,n=document.querySelector("#pending");n.disabled=0===e}(),function(){const e=t.filter((t=>"1"===t.status)).length,n=document.querySelector("#completed");n.disabled=0===e}();const n=e.length?e:t;if(0===n.length){const t=document.querySelector("#task-list"),e=document.createElement("LI");return e.textContent="No hay tareas en este proyecto",e.classList.add("no-tasks"),void t.appendChild(e)}const o={0:"Pendiente",1:"Completada"};n.forEach((e=>{const n=document.createElement("LI");n.dataset.taskId=e.id,n.classList.add("task");const r=document.createElement("P");r.textContent=e.name,r.ondblclick=function(){s(edit=!0,{...e})};const i=document.createElement("DIV");i.classList.add("options");const l=document.createElement("BUTTON");l.classList.add("status-task"),l.classList.add(`${o[e.status].toLowerCase()}`),l.textContent=o[e.status],l.dataset.status=e.status,l.ondblclick=function(){!function(t){const e="1"===t.status?"0":"1";t.status=e,c(t)}({...e})};const u=document.createElement("BUTTON");u.classList.add("delete-task"),u.dataset.taskId=e.id,u.textContent="Eliminar",u.ondblclick=function(){!function(e){Swal.fire({title:"¿Estás seguro?",text:"Este cambio no se puede revertir",icon:"warning",showCancelButton:!0,confirmButtonColor:"#CFD2B2",cancelButtonColor:"#BF0603",confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"}).then((n=>{n.isConfirmed&&async function(e){const{id:n,name:s,status:o}=e,c=new FormData;c.append("id",n),c.append("name",s),c.append("status",o),c.append("url",d());try{const e="http://localhost:3000/api/tasks/delete",s=await fetch(e,{method:"POST",body:c}),o=await s.json();o.result&&(Swal.fire("Tarea eliminada",o.message,"success"),t=t.filter((t=>t.id!==n)),a())}catch(t){console.log(t)}}(e)}))}({...e})},i.appendChild(l),i.appendChild(u),n.appendChild(r),n.appendChild(i);document.querySelector("#task-list").appendChild(n)}))}function s(e=!1,n={}){const s=document.createElement("DIV");s.classList.add("modal"),s.innerHTML=`\n            <form class="form new-task">\n                <legend>${e?"Editar tarea":"Añade una nueva tarea"}</legend>\n                <div class="field">\n                    <label for="task">Nombre de la tarea</label>\n                    <input type="text" id="task" name="task" value="${n.name?n.name:""}" placeholder="${n.name?"Editar tarea":"Ingresa el nombre de la tarea"}"/>\n                </div>\n\n                <div class="options">\n                    <input type="submit" class="submit-new-task" value="Aceptar"/>\n                    <button type="button" class="close-modal">Cancelar</button>\n                </div>\n\n            </form>\n            `,setTimeout((()=>{document.querySelector(".form").classList.add("animate")}),0),s.addEventListener("click",(r=>{if(r.preventDefault(),r.target.classList.contains("close-modal")){document.querySelector(".form").classList.add("close"),setTimeout((()=>{s.remove()}),500)}if(r.target.classList.contains("submit-new-task")){const s=document.querySelector("#task").value.trim();if(""===s)return void o("El nombre de la tarea es obligatorio","error",document.querySelector(".form legend"));e?(n.name=s,c(n)):async function(e){const n=new FormData;n.append("name",e),n.append("projectId",d());try{const s="http://localhost:3000/api/tasks",c=await fetch(s,{method:"POST",body:n}),d=await c.json();if(o(d.message,d.type,document.querySelector(".form legend")),"success"===d.type){const n=document.querySelector(".modal");setTimeout((()=>{n.remove()}),1200);const s={id:String(d.id),name:e,status:"0",projectId:d.projectId};t=[...t,s],a()}}catch(t){console.log(t)}}(s)}})),document.querySelector(".dashboard").appendChild(s)}function o(t,e,n){const a=document.querySelector(".alert");a&&a.remove();const s=document.createElement("DIV");s.classList.add("alert",e),s.textContent=t,n.parentElement.insertBefore(s,n.nextElementSibling),setTimeout((()=>{s.remove()}),3e3)}async function c(e){const{id:n,name:s,status:o,projectId:c}=e,r=new FormData;r.append("id",n),r.append("name",s),r.append("status",o),r.append("projectId",c),r.append("url",d());try{const e="http://localhost:3000/api/tasks/update",c=await fetch(e,{method:"POST",body:r}),d=await c.json();if("success"===d.response.type){Swal.fire(d.response.message,d.response.message,"success");const e=document.querySelector(".modal");e&&e.remove(),t=t.map((t=>(t.id===n&&(t.status=o,t.name=s),t))),a()}}catch(t){console.log(t)}}function d(){return Object.fromEntries(new URLSearchParams(window.location.search)).url}document.querySelectorAll('.filter input[type="radio"]').forEach((t=>{t.addEventListener("input",n)}))}();